<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAssembly and API Example</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-light">
    <div class="container my-5">
        <h1 class="text-center">WebAssembly & API Example</h1>
        <div class="form-group">
            <label for="num1">Number 1:</label>
            <input type="number" id="num1" class="form-control">
        </div>
        <div class="form-group">
            <label for="num2">Number 2:</label>
            <input type="number" id="num2" class="form-control">
        </div>
        <button id="calculate" class="btn btn-primary">Calculate Sum</button>
        <h2 class="mt-3">Result: <span id="result">0</span></h2>

        <h2 class="mt-5">API Data Visualization</h2>
        <div class="chart-container">
            <canvas id="myChart"></canvas>
        </div>

        <h2 class="mt-5">Line Chart</h2>
        <div class="chart-container">
            <canvas id="lineChart"></canvas>
        </div>

        <h2 class="mt-5">Bar Chart</h2>
        <div class="chart-container">
            <canvas id="barChart"></canvas>
        </div>

    </div>

    <script>
        // WebAssembly modülünü base64 olarak tanımlıyoruz
        const wasmCode = Uint8Array.from(atob("AGFzbQEAAAABYgFyc2hhcB9hcGkAAwABPQIEAAAAAAIAAwEAAQHAAQAAAAAAAAAAAAAAAAAAABAAQAAAAAAAAAAQBowCgAAgDBAAEAAEAwAAQIABgAABQgAAwEAAAGgCgABIAEAAwEAAwEAAwEAAwEAAwEAAwEAAwEAAwEAAwEAAwEAAwEAAwEAAwEAAAGsAAAAAAAAABkAAwABAAUAAQAAEAIAAA..."), len => len/2); // base64 formatındaki wasm dosyası

        let wasmInstance;

        // WebAssembly modülünü yükleyip başlatıyoruz
        WebAssembly.instantiate(wasmCode).then(wasm => {
            wasmInstance = wasm.instance;
        });

        document.getElementById("calculate").addEventListener("click", () => {
            const num1 = parseInt(document.getElementById("num1").value);
            const num2 = parseInt(document.getElementById("num2").value);
            const result = wasmInstance.exports.add(num1, num2); // WebAssembly modülündeki 'add' fonksiyonu
            document.getElementById("result").innerText = result;
        });

        // API Fetch fonksiyonu
        async function fetchAPIData() {
            try {
                const response = await fetch('https://api.coindesk.com/v1/bpi/currentprice.json');
                const data = await response.json();
                return data.bpi;
            } catch (error) {
                console.error('Fetch error: ', error);
            }
        }

        // Grafik oluşturma
        function createChart(ctx, chartType, data) {
            const { labels, values } = data;
            new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Bitcoin Prices',
                        data: values,
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                font: {
                                    size: 16
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Bitcoin Price Over Time',
                            font: {
                                size: 20
                            }
                        }
                    }
                }
            });
        }

        // Sayfa yüklendiğinde grafik verilerini al
        window.onload = async function () {
            const apiData = await fetchAPIData();
            const labels = Object.keys(apiData).map(currency => currency); // API'den gelen para birimleri
            const values = Object.values(apiData).map(currency => currency.rate_float); // API'den gelen değerler

            // Farklı grafik türleri oluştur
            const barCtx = document.getElementById('barChart').getContext('2d');
            createChart(barCtx, 'bar', { labels: labels, values: values });

            const lineCtx = document.getElementById('lineChart').getContext('2d');
            createChart(lineCtx, 'line', { labels: labels, values: values });

            const myChartCtx = document.getElementById('myChart').getContext('2d');
            createChart(myChartCtx, 'doughnut', { labels: labels, values: values });
        };
    </script>
</body>

</html>
